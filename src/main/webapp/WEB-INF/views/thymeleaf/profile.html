<div th:replace="fragments/header.html"></div>

    <main role="main" class="container-fluid m-f">

        <section>

            <article class="container text-white bg-windows mx-auto col-lg-8 p-2 mb-3 rounded-4">

                <h2 class="titleView fs-2 py-4" th:text="${nickName}"></h2>

            </article>

            <article class="container text-white bg-windows mx-auto col-lg-8 px-2 py-4 my-3 rounded-4">

                <h2 class="titleView fs-3 pb-4">Mis Vehículos</h2>

                <div class="py-2">

                    <div th:each="vechicle : ${vehicles}">

                        <div class="d-flex bg-secondary rounded-4 my-2 align-items-center justify-content-between p-2">

                            <div class="d-flex align-items-center justify-content-between text-truncate">

                                <i class="fa-solid fa-car-side text-white fs-5"></i>

                                <p class="m-0 text-truncate px-3" th:text="${vechicle.model + ' - ' + vechicle.patent}"></p>

                            </div>

                            <a href="#"><i class="fa-solid fa-gear text-blue"></i></a>

                        </div>

                    </div>

                    <div class="text-end">

                        <a class="btn btn-lg btn-block rounded-4 box-shadow text-bold px-3 fs-6 text-center btn-primary" th:href="@{/vehicle-register.html}"><i class="fa-solid fa-plus fs-6"></i></a>

                    </div>

                </div>

            </article>

            <article class="container text-white bg-windows mx-auto col-lg-8 px-2 py-4 mt-3 mb-3 rounded-4">

                <h2 class="titleView fs-3 pb-4">Historial de Parkings</h2>

                <div class="py-2">

                    <div th:each="parking : ${parkings}">

                        <div class="p-2 d-flex bg-secondary rounded-4 my-2 align-items-center justify-content-between">

                            <div class="d-flex align-items-center justify-content-between text-truncate">

                                <i class="fa-solid fa-location-dot text-blue fs-5"></i>

                                <p class="geolocation d-none " th:text="${parking.getGeolocation()}"></p>

                                <p class="direction m-0 text-truncate px-3" th:text="'No se encontro la dirección correspondiente'"></p>

                            </div>

                            <a href="#"><i class="fa-solid fa-circle-xmark text-blue"></i></a>

                        </div>

                    </div>

                    <div class="text-end">

                        <a class="btn btn-lg btn-block rounded-4 box-shadow text-bold px-3 fs-6 text-center btn-primary" th:href="@{/mobile/parking}"><i class="fa-solid fa-plus fs-6"></i></a>

                    </div>

                </div>

            </article>

        </section>

    </main>

<script>
    var credentials = "AmmJKyxVf-6eaa2iHK_GT4J0wH58FQbLciGKGgSMYZWJSjeZ8x5Tc67SrzWnTLmQ";

    var geolocationElements = document.querySelectorAll(".geolocation");
    var directionElements = document.querySelectorAll(".direction");

    for (let i = 0; i < geolocationElements.length; i++) {
        var geolocation = geolocationElements[i].textContent.split(',');

        var lat = geolocation[0];
        var ln = geolocation[1];

        const url = 'https://dev.virtualearth.net/REST/v1/Locations/' + lat + ',' + ln + '?key=' + credentials;

        fetch(url)
            .then(response => response.json())
            .then(data => {
                if (data.resourceSets.length > 0 && data.resourceSets[0].resources.length > 0) {
                    directionElements[i].textContent = data.resourceSets[0].resources[0].address.formattedAddress;
                } else {
                    console.error('No se encontró ninguna dirección.');
                }
            })
            .catch(error => {
                console.error('Error en la solicitud: ', error);
            });
        const firstElementIcon = document.querySelector(".fa-location-dot");
        firstElementIcon.classList.remove("text-blue");
        firstElementIcon.classList.add("text-danger");
    }
</script>

<div th:replace="fragments/footer.html"></div>